<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin | Luo City Spa</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/png" href="images/menu_logo_v2.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Lato:wght@300;400;700&display=swap"
      rel="stylesheet"
    />

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  </head>
  <body>
    <header>
      <div class="container">
        <nav>
          <a href="index.html" class="logo"
            ><img src="images/menu_logo_v2.png" alt="Luo City Spa"
          /></a>
          <div
            class="menu-toggle"
            onclick="
              document.querySelector('.nav-links').classList.toggle('active')
            "
          >
            <i class="fas fa-bars"></i>
          </div>
          <ul class="nav-links">
            <li><a href="index.html">View Site</a></li>
            <li><a href="admin.html" class="active">Admin</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <div class="container" id="admin-view">
      <div
        id="auth-box"
        style="
          max-width: 400px;
          margin: 50px auto;
          background: white;
          padding: 30px;
          border-radius: 10px;
          text-align: center;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        "
      >
        <h2>Admin Login</h2>
        <input
          type="email"
          id="login-email"
          placeholder="Email"
          style="
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
          "
        />
        <input
          type="password"
          id="login-pass"
          placeholder="Password"
          style="
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
          "
        />
        <button class="btn" onclick="login()">Login</button>
        <div style="margin-top: 10px; font-size: 0.8rem; color: #888">
          Use "Create User" below first if new.
        </div>
        <!-- <div
          style="
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 10px;
          "
        >
          <button
            class="btn"
            style="background: #666; font-size: 0.8rem"
            onclick="createUser()"
          >
            Create User
          </button>
        </div> -->
      </div>

      <div id="dashboard-box" class="hide">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
          "
        >
          <h2 style="margin: 0">Content Manager</h2>
          <button class="btn" style="background: #333" onclick="logout()">
            Logout
          </button>
        </div>

        <!-- NEW: Main filter dropdown -->
        <div class="admin-main-filter">
          <label for="admin-section-select">Choose a section to manage:</label>
          <select id="admin-section-select">
            <option value="seo-panel">SEO Settings</option>
            <option value="banners-panel">Home Page Banners</option>
            <option value="services-panel">Service Packages</option>
            <option value="gallery-panel">Gallery Photos</option>
            <option value="videos-panel">Videos</option>
            <option value="social-panel">Social Posts</option>
            <option value="memberships-panel">Memberships</option>
            <option value="chatbot-panel">Chatbot Training</option>
          </select>
        </div>

        <div id="seo-panel" class="admin-panel admin-content-section">
          <h3><i class="fas fa-search"></i> SEO Settings</h3>
          <div class="admin-form">
            <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px">
              Update site-wide title and meta tags for search engines.
            </p>
            <input
              type="text"
              id="seo-title"
              placeholder="Website Title (e.g. Luo City Spa Club)"
            />
            <textarea
              id="seo-desc"
              placeholder="Meta Description (Recommended: 150-160 chars)"
              rows="3"
            ></textarea>
            <input
              type="text"
              id="seo-keywords"
              placeholder="Keywords (comma separated)"
            />
            <button class="btn" onclick="saveSeo()">Save SEO Settings</button>
          </div>
        </div>

        <div id="banners-panel" class="admin-panel admin-content-section">
          <h3><i class="fas fa-images"></i> Home Page Banners</h3>
          <div class="admin-form">
            <input type="text" id="banner-url" placeholder="Banner Image URL" />
            <button class="btn" onclick="addContent('banner')">
              Add Banner
            </button>
          </div>
          <div id="admin-banner-list"></div>
        </div>

        <div id="services-panel" class="admin-panel admin-content-section">
          <h3><i class="fas fa-spa"></i> Add Service Package</h3>
          <div class="admin-form">
            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 15px;
              "
            >
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Service Name - ðŸ‡¬ðŸ‡§ English</label
                >
                <input
                  type="text"
                  id="serv-title-en"
                  placeholder="e.g. Swedish Massage"
                />
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Service Name - ðŸ‡¨ðŸ‡³ Chinese</label
                >
                <input
                  type="text"
                  id="serv-title-zh"
                  placeholder="e.g. ç‘žå…¸æŒ‰æ‘©"
                />
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Service Name - ðŸ‡¯ðŸ‡µ Japanese</label
                >
                <input
                  type="text"
                  id="serv-title-jp"
                  placeholder="e.g. ã‚¹ã‚¦ã‚§ãƒ‡ã‚£ãƒƒã‚·ãƒ¥ãƒžãƒƒã‚µãƒ¼ã‚¸"
                />
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Service Name - ðŸ‡°ðŸ‡· Korean</label
                >
                <input
                  type="text"
                  id="serv-title-ko"
                  placeholder="e.g. ìŠ¤ì›¨ë””ì‹œ ë§ˆì‚¬ì§€"
                />
              </div>
            </div>

            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 15px;
              "
            >
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Description - ðŸ‡¬ðŸ‡§ English</label
                >
                <textarea
                  id="serv-desc-en"
                  placeholder="60 mins relaxing oil massage..."
                  rows="4"
                ></textarea>
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Description - ðŸ‡¨ðŸ‡³ Chinese</label
                >
                <textarea
                  id="serv-desc-zh"
                  placeholder="60åˆ†é’Ÿæ”¾æ¾æ²¹æŒ‰æ‘©..."
                  rows="4"
                ></textarea>
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Description - ðŸ‡¯ðŸ‡µ Japanese</label
                >
                <textarea
                  id="serv-desc-jp"
                  placeholder="60åˆ†é–“ã®ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚ªã‚¤ãƒ«ãƒžãƒƒã‚µãƒ¼ã‚¸..."
                  rows="4"
                ></textarea>
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Description - ðŸ‡°ðŸ‡· Korean</label
                >
                <textarea
                  id="serv-desc-ko"
                  placeholder="60ë¶„ì˜ íŽ¸ì•ˆí•œ ì˜¤ì¼ ë§ˆì‚¬ì§€..."
                  rows="4"
                ></textarea>
              </div>
            </div>

            <input
              type="text"
              id="serv-img"
              placeholder="Image URL"
              style="margin-bottom: 15px"
            />
            <button class="btn" onclick="addContent('service')">
              Add Service
            </button>
          </div>
          <div id="admin-service-list"></div>
        </div>

        <div id="gallery-panel" class="admin-panel admin-content-section">
          <h3><i class="fas fa-images"></i> Add Photo</h3>
          <div class="admin-form">
            <input type="text" id="img-url" placeholder="Image URL" />
            <button class="btn" onclick="addContent('gallery')">
              Add to Gallery
            </button>
          </div>
          <div id="admin-gallery-list"></div>
        </div>

        <div id="videos-panel" class="admin-panel admin-content-section">
          <h3><i class="fas fa-video"></i> Add Video</h3>
          <div class="admin-form">
            <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px">
              Enter YouTube or TikTok URL (e.g.
              https://www.tiktok.com/@user/video/...)
            </p>
            <input
              type="text"
              id="vid-url"
              placeholder="Video URL (YouTube or TikTok)"
              style="margin-bottom: 15px"
            />

            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 15px;
              "
            >
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Video Title - ðŸ‡¬ðŸ‡§ English</label
                >
                <input
                  type="text"
                  id="vid-title-en"
                  placeholder="e.g. Spa Tour"
                />
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Video Title - ðŸ‡¨ðŸ‡³ Chinese</label
                >
                <input
                  type="text"
                  id="vid-title-zh"
                  placeholder="e.g. æ°´ç–—ä¸­å¿ƒä¹‹æ—…"
                />
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Video Title - ðŸ‡¯ðŸ‡µ Japanese</label
                >
                <input
                  type="text"
                  id="vid-title-jp"
                  placeholder="e.g. ã‚¹ãƒ‘ãƒ„ã‚¢ãƒ¼"
                />
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Video Title - ðŸ‡°ðŸ‡· Korean</label
                >
                <input
                  type="text"
                  id="vid-title-ko"
                  placeholder="e.g. ìŠ¤íŒŒ íˆ¬ì–´"
                />
              </div>
            </div>

            <button class="btn" onclick="addContent('video')">Add Video</button>
          </div>
          <div id="admin-video-list"></div>
        </div>

        <div id="social-panel" class="admin-panel admin-content-section">
          <h3><i class="fas fa-share-alt"></i> Add Social Post</h3>
          <div class="admin-form">
            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 15px;
              "
            >
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Post Content - ðŸ‡¬ðŸ‡§ English</label
                >
                <textarea
                  id="post-content-en"
                  placeholder="Post content..."
                  rows="4"
                ></textarea>
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Post Content - ðŸ‡¨ðŸ‡³ Chinese</label
                >
                <textarea
                  id="post-content-zh"
                  placeholder="å¸–å­å†…å®¹..."
                  rows="4"
                ></textarea>
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Post Content - ðŸ‡¯ðŸ‡µ Japanese</label
                >
                <textarea
                  id="post-content-jp"
                  placeholder="æŠ•ç¨¿å†…å®¹..."
                  rows="4"
                ></textarea>
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Post Content - ðŸ‡°ðŸ‡· Korean</label
                >
                <textarea
                  id="post-content-ko"
                  placeholder="ê²Œì‹œë¬¼ ë‚´ìš©..."
                  rows="4"
                ></textarea>
              </div>
            </div>

            <input
              type="text"
              id="post-img"
              placeholder="Image URL (Optional)"
              style="margin-bottom: 15px"
            />
            <input
              type="text"
              id="post-link"
              placeholder="Post Link (e.g. https://facebook.com/post/123)"
              style="
                border-left: 3px solid var(--secondary);
                margin-bottom: 15px;
              "
            />
            <button class="btn" onclick="addContent('social')">Add Post</button>
          </div>
          <div id="admin-social-list"></div>
        </div>

        <div id="memberships-panel" class="admin-panel admin-content-section">
          <h3>
            <i class="fas fa-id-card"></i>
            <span data-i18n="admin.tabs.membership">Manage Memberships</span>
          </h3>
          <div class="admin-form">
            <select
              id="mem-name"
              onchange="loadMembershipDetails()"
              style="
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 4px;
                background: white;
                margin-bottom: 15px;
              "
            >
              <option value="black">Black Card</option>
              <option value="green">Green Card</option>
              <option value="newer">Newer Card</option>
            </select>

            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 15px;
              "
            >
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Recharge Amount - ðŸ‡¬ðŸ‡§ English</label
                >
                <input
                  type="text"
                  id="mem-recharge-en"
                  placeholder="e.g. PHP 100,000+"
                />
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Recharge Amount - ðŸ‡¨ðŸ‡³ Chinese</label
                >
                <input
                  type="text"
                  id="mem-recharge-zh"
                  placeholder="e.g. PHP 100,000+"
                />
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Recharge Amount - ðŸ‡¯ðŸ‡µ Japanese</label
                >
                <input
                  type="text"
                  id="mem-recharge-jp"
                  placeholder="e.g. PHP 100,000+"
                />
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Recharge Amount - ðŸ‡°ðŸ‡· Korean</label
                >
                <input
                  type="text"
                  id="mem-recharge-ko"
                  placeholder="e.g. PHP 100,000+"
                />
              </div>
            </div>

            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 15px;
              "
            >
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Benefits - ðŸ‡¬ðŸ‡§ English</label
                >
                <textarea
                  id="mem-benefits-en"
                  placeholder="Benefits (One per line)"
                  rows="4"
                ></textarea>
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Benefits - ðŸ‡¨ðŸ‡³ Chinese</label
                >
                <textarea
                  id="mem-benefits-zh"
                  placeholder="ç¦åˆ© (æ¯è¡Œä¸€ä¸ª)"
                  rows="4"
                ></textarea>
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Benefits - ðŸ‡¯ðŸ‡µ Japanese</label
                >
                <textarea
                  id="mem-benefits-jp"
                  placeholder="ç‰¹å…¸ (1è¡Œã«1ã¤)"
                  rows="4"
                ></textarea>
              </div>
              <div>
                <label
                  style="
                    font-weight: bold;
                    display: block;
                    margin-bottom: 5px;
                    color: #333;
                  "
                  >Benefits - ðŸ‡°ðŸ‡· Korean</label
                >
                <textarea
                  id="mem-benefits-ko"
                  placeholder="í˜œíƒ (í•œ ì¤„ì— í•˜ë‚˜)"
                  rows="4"
                ></textarea>
              </div>
            </div>

            <button
              class="btn"
              onclick="addContent('membership')"
              data-i18n="buttons.update"
            >
              Update Membership
            </button>
          </div>
          <div id="admin-membership-list"></div>
        </div>

        <div id="chatbot-panel" class="admin-panel admin-content-section">
          <h3><i class="fas fa-robot"></i> Chatbot Training Prompt</h3>
          <div class="admin-form">
            <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px">
              Write a detailed paragraph describing your spa. Include everything
              you want the AI to know: services, prices, membership cards,
              benefits, hours, contact info, facilities, amenities, dining,
              policies, etc. The chatbot will use this to answer customer
              questions. The more detailed, the better!
            </p>
            <textarea
              id="chatbot-prompt"
              placeholder="You are the AI assistant for Luo City Spa Club. Share details about your services, prices, membership benefits, hours, location, contact info, facilities, and any policies. Example: You are the AI assistant for Luo City Spa Club in Pasay. We offer massage services including Swedish, Chinese, Head Massage, Foot Massage, and more. Our Black Card costs PHP 100,000 and includes unlimited discounts, free WiFi, and priority booking..."
              rows="15"
              style="
                font-family: &quot;Lato&quot;, sans-serif;
                padding: 15px;
                line-height: 1.5;
              "
            ></textarea>
            <button class="btn" onclick="saveChatbotPrompt()">
              Save & Train Chatbot
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAfaVfpgWBP0l1xnt0s91mR2C6mSWAam6U",
        authDomain: "luo-city-spa-club-836bf.firebaseapp.com",
        projectId: "luo-city-spa-club-836bf",
        storageBucket: "luo-city-spa-club-836bf.firebasestorage.app",
        messagingSenderId: "25443267460",
        appId: "1:25443267460:web:d345d5227187b6716da3d1",
        measurementId: "G-P857NTSPJ2",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      const auth = firebase.auth();

      auth.onAuthStateChanged((user) => {
        if (user) {
          document.getElementById("auth-box").classList.add("hide");
          document.getElementById("dashboard-box").classList.remove("hide");
          loadAdminData();

          // NEW: Admin page section filter logic
          const sectionSelect = document.getElementById("admin-section-select");
          const contentSections = document.querySelectorAll(
            ".admin-content-section",
          );

          function showAdminSection(sectionId) {
            contentSections.forEach((section) => {
              section.style.display =
                section.id === sectionId ? "block" : "none";
            });
          }

          if (sectionSelect && contentSections.length > 0) {
            showAdminSection(sectionSelect.value); // Show default section
            sectionSelect.addEventListener("change", (e) =>
              showAdminSection(e.target.value),
            );
          }
        } else {
          document.getElementById("auth-box").classList.remove("hide");
          document.getElementById("dashboard-box").classList.add("hide");
        }
      });

      function login() {
        const e = document.getElementById("login-email").value;
        const p = document.getElementById("login-pass").value;
        auth
          .signInWithEmailAndPassword(e, p)
          .catch((err) => alert(err.message));
      }
      function logout() {
        auth.signOut();
      }

      function loadMembershipDetails() {
        const key = document.getElementById("mem-name").value;
        db.ref("memberships/" + key).once("value", (snap) => {
          const val = snap.val();
          if (val) {
            // Load recharge amounts for all languages
            document.getElementById("mem-recharge-en").value =
              val.recharge_en || "";
            document.getElementById("mem-recharge-zh").value =
              val.recharge_zh || "";
            document.getElementById("mem-recharge-jp").value =
              val.recharge_jp || "";
            document.getElementById("mem-recharge-ko").value =
              val.recharge_ko || "";

            // Load benefits for all languages
            document.getElementById("mem-benefits-en").value =
              val.benefits_en || "";
            document.getElementById("mem-benefits-zh").value =
              val.benefits_zh || "";
            document.getElementById("mem-benefits-jp").value =
              val.benefits_jp || "";
            document.getElementById("mem-benefits-ko").value =
              val.benefits_ko || "";
          } else {
            // Clear all fields if no data
            document.getElementById("mem-recharge-en").value = "";
            document.getElementById("mem-recharge-zh").value = "";
            document.getElementById("mem-recharge-jp").value = "";
            document.getElementById("mem-recharge-ko").value = "";
            document.getElementById("mem-benefits-en").value = "";
            document.getElementById("mem-benefits-zh").value = "";
            document.getElementById("mem-benefits-jp").value = "";
            document.getElementById("mem-benefits-ko").value = "";
          }
        });
      }

      function saveSeo() {
        const title = document.getElementById("seo-title").value;
        const desc = document.getElementById("seo-desc").value;
        const keywords = document.getElementById("seo-keywords").value;

        db.ref("settings/seo").set(
          {
            title: title,
            description: desc,
            keywords: keywords,
          },
          (error) => {
            if (error) alert("Error saving SEO settings: " + error.message);
            else alert("SEO Settings Saved!");
          },
        );
      }

      function saveChatbotPrompt() {
        const prompt = document.getElementById("chatbot-prompt").value;
        if (!prompt) {
          alert("Please write your chatbot training prompt!");
          return;
        }

        db.ref("settings/chatbot").set(
          {
            prompt: prompt,
            updated: Date.now(),
          },
          (error) => {
            if (error) alert("Error saving chatbot training: " + error.message);
            else alert("Chatbot Training Saved! Changes will apply instantly.");
          },
        );
      }

      function addContent(type) {
        let data = {};
        let refName = "";

        // NEW: Banner Logic
        if (type === "banner") {
          const url = document.getElementById("banner-url").value;
          if (!url) return;
          data = { url, date: Date.now() };
          refName = "banners";
          document.getElementById("banner-url").value = "";
        } else if (type === "service") {
          // Collect all 4 languages
          const titleEn = document.getElementById("serv-title-en").value;
          const titleZh = document.getElementById("serv-title-zh").value;
          const titleJp = document.getElementById("serv-title-jp").value;
          const titleKo = document.getElementById("serv-title-ko").value;

          const descEn = document.getElementById("serv-desc-en").value;
          const descZh = document.getElementById("serv-desc-zh").value;
          const descJp = document.getElementById("serv-desc-jp").value;
          const descKo = document.getElementById("serv-desc-ko").value;

          const image = document.getElementById("serv-img").value;

          if (!titleEn) {
            alert("Please enter service name in English");
            return;
          }

          data = {
            title_en: titleEn,
            title_zh: titleZh,
            title_jp: titleJp,
            title_ko: titleKo,
            description_en: descEn,
            description_zh: descZh,
            description_jp: descJp,
            description_ko: descKo,
            image,
            date: Date.now(),
          };
          refName = "services";
          // Clear form fields
          document.getElementById("serv-title-en").value = "";
          document.getElementById("serv-title-zh").value = "";
          document.getElementById("serv-title-jp").value = "";
          document.getElementById("serv-title-ko").value = "";
          document.getElementById("serv-desc-en").value = "";
          document.getElementById("serv-desc-zh").value = "";
          document.getElementById("serv-desc-jp").value = "";
          document.getElementById("serv-desc-ko").value = "";
          document.getElementById("serv-img").value = "";
        } else if (type === "gallery") {
          const url = document.getElementById("img-url").value;
          if (!url) return;
          data = { url, date: Date.now() };
          refName = "gallery";
          document.getElementById("img-url").value = "";
        } else if (type === "video") {
          const url = document.getElementById("vid-url").value;
          // Collect all 4 languages for title
          const titleEn = document.getElementById("vid-title-en").value;
          const titleZh = document.getElementById("vid-title-zh").value;
          const titleJp = document.getElementById("vid-title-jp").value;
          const titleKo = document.getElementById("vid-title-ko").value;

          if (!url) {
            alert("Please enter YouTube URL");
            return;
          }

          data = {
            url,
            title_en: titleEn,
            title_zh: titleZh,
            title_jp: titleJp,
            title_ko: titleKo,
            date: Date.now(),
          };
          refName = "videos";
          // Clear form fields
          document.getElementById("vid-url").value = "";
          document.getElementById("vid-title-en").value = "";
          document.getElementById("vid-title-zh").value = "";
          document.getElementById("vid-title-jp").value = "";
          document.getElementById("vid-title-ko").value = "";
        } else if (type === "social") {
          // Collect all 4 languages for content
          const contentEn = document.getElementById("post-content-en").value;
          const contentZh = document.getElementById("post-content-zh").value;
          const contentJp = document.getElementById("post-content-jp").value;
          const contentKo = document.getElementById("post-content-ko").value;

          const image = document.getElementById("post-img").value;
          const link = document.getElementById("post-link").value;

          if (!contentEn) {
            alert("Please enter post content in English");
            return;
          }

          data = {
            content_en: contentEn,
            content_zh: contentZh,
            content_jp: contentJp,
            content_ko: contentKo,
            image,
            link,
            date: Date.now(),
          };
          refName = "social";
          // Clear form fields
          document.getElementById("post-content-en").value = "";
          document.getElementById("post-content-zh").value = "";
          document.getElementById("post-content-jp").value = "";
          document.getElementById("post-content-ko").value = "";
          document.getElementById("post-img").value = "";
          document.getElementById("post-link").value = "";
        } else if (type === "membership") {
          const select = document.getElementById("mem-name");
          const name = select.options[select.selectedIndex].text;
          const key = select.value;

          // Get all 4 languages for recharge
          const rechargeEn = document.getElementById("mem-recharge-en").value;
          const rechargeZh = document.getElementById("mem-recharge-zh").value;
          const rechargeJp = document.getElementById("mem-recharge-jp").value;
          const rechargeKo = document.getElementById("mem-recharge-ko").value;

          // Get all 4 languages for benefits
          const benefitsEn = document.getElementById("mem-benefits-en").value;
          const benefitsZh = document.getElementById("mem-benefits-zh").value;
          const benefitsJp = document.getElementById("mem-benefits-jp").value;
          const benefitsKo = document.getElementById("mem-benefits-ko").value;

          data = {
            name,
            recharge_en: rechargeEn,
            recharge_zh: rechargeZh,
            recharge_jp: rechargeJp,
            recharge_ko: rechargeKo,
            benefits_en: benefitsEn,
            benefits_zh: benefitsZh,
            benefits_jp: benefitsJp,
            benefits_ko: benefitsKo,
            date: Date.now(),
          };

          db.ref("memberships/" + key).set(data);
          alert("Membership Updated!");
          // Don't clear fields so user can see what they updated
          return;
        }

        db.ref(refName).push(data);
        alert("Added!");
      }

      function deleteItem(type, key) {
        if (confirm("Delete this item?")) {
          db.ref(type + "/" + key).remove();
        }
      }

      // Helper function to get localized content with fallback
      function getLocalizedContent(item, fieldName) {
        if (!item || !fieldName) return "";
        // Get current language from i18next or localStorage
        const lang = (
          i18next?.language ||
          localStorage.getItem("userLanguage") ||
          "en"
        ).substring(0, 2);

        // Try current language first
        if (item[`${fieldName}_${lang}`]) {
          return item[`${fieldName}_${lang}`];
        }
        // Fallback to English
        if (item[`${fieldName}_en`]) {
          return item[`${fieldName}_en`];
        }
        // Fallback to original field (for backward compatibility)
        if (item[fieldName]) {
          return item[fieldName];
        }
        return "";
      }

      function loadAdminData() {
        const renderList = (snap, id, type) => {
          const el = document.getElementById(id);
          if (!el) return;

          el.innerHTML = "";
          if (snap.val()) {
            Object.entries(snap.val())
              .reverse()
              .forEach(([key, item]) => {
                let contentHtml = "";
                let dateStr = new Date(item.date).toLocaleDateString();

                if (type === "banners") {
                  contentHtml = `<img src="${item.url}" style="height:50px; border-radius:4px;"> <strong>Banner Slide</strong>`;
                } else if (type === "services") {
                  const titleEn = item.title_en || "";
                  const titleZh = item.title_zh || "";
                  const titleJp = item.title_jp || "";
                  const titleKo = item.title_ko || "";
                  const descEn = item.description_en || "";

                  contentHtml = `
                    <div style="margin-bottom: 10px;">
                      <strong style="color: var(--primary);">${titleEn}</strong>
                      ${titleZh ? `<span style="margin-left: 10px; padding: 2px 6px; background: #f0f0f0; border-radius: 3px; font-size: 0.85rem;">${titleZh}</span>` : ""}
                      ${titleJp ? `<span style="margin-left: 5px; padding: 2px 6px; background: #f0f0f0; border-radius: 3px; font-size: 0.85rem;">${titleJp}</span>` : ""}
                      ${titleKo ? `<span style="margin-left: 5px; padding: 2px 6px; background: #f0f0f0; border-radius: 3px; font-size: 0.85rem;">${titleKo}</span>` : ""}
                    </div>
                    <small style="color:#666; display: block; margin-top: 5px;">${descEn ? descEn.substring(0, 60) + "..." : "No description"}</small>
                  `;
                } else if (type === "videos") {
                  const titleEn = item.title_en || "Untitled";
                  const titleZh = item.title_zh || "";
                  const titleJp = item.title_jp || "";
                  const titleKo = item.title_ko || "";

                  contentHtml = `
                    <div style="margin-bottom: 5px;">
                      <strong>${titleEn}</strong>
                      ${titleZh ? `<span style="margin-left: 10px; padding: 2px 6px; background: #f0f0f0; border-radius: 3px; font-size: 0.85rem;">${titleZh}</span>` : ""}
                      ${titleJp ? `<span style="margin-left: 5px; padding: 2px 6px; background: #f0f0f0; border-radius: 3px; font-size: 0.85rem;">${titleJp}</span>` : ""}
                      ${titleKo ? `<span style="margin-left: 5px; padding: 2px 6px; background: #f0f0f0; border-radius: 3px; font-size: 0.85rem;">${titleKo}</span>` : ""}
                    </div>
                    <small style="color:#666;">${item.url}</small>
                  `;
                } else if (type === "gallery") {
                  contentHtml = `<img src="${item.url}" style="height:50px; border-radius:4px;">`;
                } else if (type === "social") {
                  const contentEn = item.content_en || "";
                  const contentZh = item.content_zh || "";
                  const contentJp = item.content_jp || "";
                  const contentKo = item.content_ko || "";

                  const imgHtml = item.image
                    ? `<img src="${item.image}" style="width:40px; height:40px; object-fit:cover; border-radius:4px; margin-right:10px; float:left;">`
                    : "";
                  const linkHtml = item.link
                    ? `<i class="fas fa-link" style="color:var(--primary); margin-left:5px;" title="Link attached"></i>`
                    : "";

                  contentHtml = `
                    <div style="display:flex; align-items:flex-start;">
                      ${imgHtml}
                      <div style="flex: 1;">
                        <div style="margin-bottom: 8px;">
                          <span>${contentEn.substring(0, 50)}${contentEn.length > 50 ? "..." : ""} ${linkHtml}</span>
                        </div>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap; font-size: 0.8rem;">
                          ${contentZh ? `<span style="padding: 2px 6px; background: #f0f0f0; border-radius: 3px;">${contentZh.substring(0, 30)}...</span>` : ""}
                          ${contentJp ? `<span style="padding: 2px 6px; background: #f0f0f0; border-radius: 3px;">${contentJp.substring(0, 30)}...</span>` : ""}
                          ${contentKo ? `<span style="padding: 2px 6px; background: #f0f0f0; border-radius: 3px;">${contentKo.substring(0, 30)}...</span>` : ""}
                        </div>
                      </div>
                    </div>
                  `;
                } else if (type === "memberships") {
                  const rechargeEn = item.recharge_en || "";
                  contentHtml = `<strong>${item.name}</strong><br><small>${rechargeEn}</small>`;
                }

                el.innerHTML += `
                            <div class="admin-item" style="overflow:hidden;">
                                <button class="del-btn" onclick="deleteItem('${type}', '${key}')">Ã—</button>
                                <div style="color:#aaa; font-size:0.7rem; margin-bottom:8px;">${dateStr}</div>
                                ${contentHtml}
                            </div>`;
              });
          }
        };

        // Attach Listeners
        db.ref("banners").on("value", (s) =>
          renderList(s, "admin-banner-list", "banners"),
        ); // New Listener
        db.ref("services").on("value", (s) =>
          renderList(s, "admin-service-list", "services"),
        );
        db.ref("gallery").on("value", (s) =>
          renderList(s, "admin-gallery-list", "gallery"),
        );
        db.ref("videos").on("value", (s) =>
          renderList(s, "admin-video-list", "videos"),
        );
        db.ref("social").on("value", (s) =>
          renderList(s, "admin-social-list", "social"),
        );
        db.ref("memberships").on("value", (s) =>
          renderList(s, "admin-membership-list", "memberships"),
        );

        // Load initial membership details for the default selection
        loadMembershipDetails();

        // Load SEO Settings
        db.ref("settings/seo").on("value", (snap) => {
          const val = snap.val();
          if (val) {
            if (document.getElementById("seo-title"))
              document.getElementById("seo-title").value = val.title || "";
            if (document.getElementById("seo-desc"))
              document.getElementById("seo-desc").value = val.description || "";
            if (document.getElementById("seo-keywords"))
              document.getElementById("seo-keywords").value =
                val.keywords || "";
          }
        });

        // Load Chatbot Prompt
        db.ref("settings/chatbot").on("value", (snap) => {
          const val = snap.val();
          if (val && val.prompt) {
            if (document.getElementById("chatbot-prompt"))
              document.getElementById("chatbot-prompt").value =
                val.prompt || "";
          }
        });
      }
    </script>
    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>Luo City Spa Club</h3>
            <p>
              Take a break from your busy routine. Relax, Recharge & Rejuvenate
              at the Best Manila Spa Experience.
            </p>
          </div>
          <div class="footer-section">
            <h3>Contact Us</h3>
            <p>
              <i class="fas fa-map-marker-alt"></i> Esplanade Seaside Terminal,
              MOA Complex, Pasay
            </p>
            <p><i class="fas fa-phone"></i> +63-999-816-8888</p>
            <p><i class="fas fa-envelope"></i> info@luospa.com</p>
          </div>
          <div class="footer-section">
            <h3>Follow Us</h3>
            <div class="social-links">
              <a href="https://www.facebook.com/luocityspa.page"
                ><i class="fab fa-facebook-f"></i
              ></a>
              <a href="https://www.instagram.com/luocity.spa/"
                ><i class="fab fa-instagram"></i
              ></a>
              <a href="https://www.tiktok.com/@luocity.spa"
                ><i class="fab fa-tiktok"></i
              ></a>
            </div>
          </div>
        </div>
        <div class="footer-bottom">
          <p>Â© 2025 Luo City Spa Club. All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
